
Bootstrap: docker
From: ubuntu:20.04

%setup  
    mkdir -p ${APPTAINER_ROOTFS}/.config/Ultralytics/
    mkdir -p ${APPTAINER_ROOTFS}/app
    cp -r requirements.txt ${APPTAINER_ROOTFS}/app/
    cp -r . ${APPTAINER_ROOTFS}/app
    cd ${APPTAINER_ROOTFS}/app
    ls -l


%post 
    # 安装Linux软件包  
    apt-get update  
    DEBIAN_FRONTEND=noninteractive TZ=Etc/UTC apt-get install -y tzdata  
    apt-get install --no-install-recommends -y python3-pip git zip curl htop libgl1-mesa-glx libglib2.0-0 libpython3-dev gnupg wget
    
    # 下载字体到用户配置目录   
    cd /.config/Ultralytics/  
    wget https://ultralytics.com/assets/Arial.ttf  
    wget https://ultralytics.com/assets/Arial.Unicode.ttf  

    # 升级pip并安装Python包  
    python3 -m pip install --upgrade pip wheel  
    pip3 install --no-cache-dir -r /app/requirements.txt ultralytics albumentations gsutil notebook \
        coremltools onnx onnx-simplifier onnxruntime tensorflow-cpu tensorflowjs \
        --extra-index-url https://download.pytorch.org/whl/cpu  

    cd /app

%runscript  
    exec python3 yolov5/detect.py --project ./test/runs/detect --weights ./test/yolov5s.pt --source ./test/zidane.jpg 