FROM python:3.10-slim

ENV PYTHONDONTWRITEBYTECODE=1

USER root
WORKDIR /app

RUN apt-get update &&  apt-get install -y --no-install-recommends libsndfile1-dev espeak-ng time g++ cmake pkg-config openssh-client

COPY ./transformers /app/transformers
COPY ./detectron2 /app/detectron2

RUN pip install --no-cache-dir -e /app/transformers \
    timm \
    torch===2.4.0+cpu \
    torchvision \
    torchaudio \
    pytesseract \
    "itsdangerous<2.1.0" \
    # --extra-index-url https://download.pytorch.org/whl/cpu
    --extra-index-url http://192.168.143.41:9081/repository/python/simple/

RUN cd /app/detectron2 && pip install --no-cache-dir -e .
RUN cd /app/transformers && python3 setup.py develop

CMD [ "/bin/bash" ]