Bootstrap: docker  
From: 192.168.2.25:10081/python:3.9-slim  

%setup  
    # Create the working directory  
    mkdir -p ${APPTAINER_ROOTFS}/app
    
    # Copy the cloned transformers repository into the container  
    cp -r ./transformers ${APPTAINER_ROOTFS}/app/transformers  

%post
    total_lines=$(wc -l < /etc/apt/sources.list.d/debian.sources) && \
    lines_to_keep=$((total_lines - 6)) && \
    head -n $lines_to_keep /etc/apt/sources.list.d/debian.sources > /etc/apt/sources.list.d/debian.sources.new; sed -i 's|http://deb.debian.org/debian|http://192.168.2.25:9081/repository/debian/|g' /etc/apt/sources.list.d/debian.sources.new; mv /etc/apt/sources.list.d/debian.sources.new /etc/apt/sources.list.d/debian.sources

    # Set the working directory  
    cd /app  

    # Install git and other dependencies  
    apt-get update && apt-get install -y curl \
        && rm -rf /var/lib/apt/lists/*  

    mkdir ~/.pip/ && \
    touch ~/.pip/pip.conf && \
    test -f ~/.pip/pip.conf && \
    mv ~/.pip/pip.conf ~/.pip/pip.conf.bak; curl -s -o ~/.pip/pip.conf -m 3 http://192.168.2.25:4000/root/staging/raw/branch/main/pip.conf

    # Install the Transformers library in editable mode and other dependencies  
    pip install --no-cache-dir -e /app/transformers \
        torch torchvision timm \
        --timeout 1000

%runscript  
    exec /bin/bash