Bootstrap: docker  
From: python:3.12-slim  

# Set working directory and copy files  
      
%post
    mkdir -p /app/whisper
%files
    ./whisper/* /app/whisper/
%post
    cd /app/whisper
    ls


%post  
    # Update and install necessary packages  
    apt-get update && apt-get install -y git wget tar xz-utils  

    # Static Build of ffmpeg  
    wget https://johnvansickle.com/ffmpeg/releases/ffmpeg-release-amd64-static.tar.xz  
    tar xvf ffmpeg-release-amd64-static.tar.xz  
    mv ffmpeg-*-amd64-static/ffmpeg /usr/bin/ffmpeg  
    rm -Rf ffmpeg*  

    # Install Python packages  
    pip install --no-cache-dir setuptools-rust  


    # Install whisper  
    cd /app/whisper  
    pip install --no-cache-dir .  

    # Run whisper command  
    whisper --model_dir /usr/local --model medium audio >> /dev/null 2>&1 || true  

%environment  
    export PATH=/usr/bin/ffmpeg:$PATH  

%help  
    This container is built to run whisper with ffmpeg support.